#include "gamevars.h"
#include <c64/vic.h>

//byte* const Screen     = (byte*)0xc800;
//byte* const Screen     = (byte*)0x0400;
//byte* const Color      = (byte*)0xd800;
//byte* const Sprite     = (byte*)0x0380;
//byte* const Sprite     = (byte*)0xd800;
//byte* const Charset    = (byte *)0xd000;


byte* const Screen     = (byte*)0xc800;
byte* const Color      = (byte*)0xd800; // Keep this, it's hardwired
byte* const Sprite     = (byte*)0xc000; // Move sprites to the start of the bank
byte* const Charset    = (byte*)0xd000;

const struct tile		tiles[7] =
{
	{ 0, 
    { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1 }, 
    { 0, 4, 7, 10 }, //  ####
    { 4, 1, 4, 1 },    
    { 1, 4, 1, 4 }, 
    VCOL_CYAN, 
    {0, 1, 2, 3}, 
    {0, 0, 0, 0}
  },
	{ 1, 
    { 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1 },
    { 0, 4, 7, 10 },   //  ##
    { 2, 2, 2, 2 },    //  ## 
    { 2, 2, 2, 2 },    
    VCOL_YELLOW,
    {0, 1, 0, 1},
    {0, 0, 1, 1}
  },
  { 2,
    { 0, 1, 0, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 0 },
    { 0, 6, 12, 18 },    //  #    #   ###    #
    { 3, 2, 3, 2 },      // ###   ##   #    ##
    { 2, 3, 2, 3 },      //       #          #
    VCOL_PURPLE,
    {1, 0, 1, 2},
    {0, 1, 1, 1}
  },
  { 3,
    { 0, 1, 1, 1, 1, 0, 1, 0, 1, 1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 0, 1, 1, 0, 1 },
    { 0, 6, 12, 18 },     //  ##   #     ##   #
    { 3, 2, 3, 2 },       // ##    ##   ##    ##
    { 2, 3, 2, 3 },       //        #          #
    VCOL_GREEN,
    {1, 2, 0, 1},
    {0, 0, 1, 1}
  },
  { 4,
    { 1, 1, 0, 0, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1, 0, 0, 1, 1, 0, 1, 1, 1, 1, 0 },
    { 0, 6, 12, 18 },     // ##
    { 3, 2, 3, 2 },       //  ##
    { 2, 3, 2, 3 },
    VCOL_RED,
    {0, 1, 1, 2},
    {0, 0, 1, 1}
  },
  { 5,
    { 1, 0, 0, 1, 1, 1, 
      1, 1, 1, 0, 1, 0, 
      1, 1, 1, 0, 0, 1,
      0, 1, 0, 1, 1, 1 },
    { 0, 6, 12, 18 },    // #    ##  ###    #
    { 3, 2, 3, 2 },      // ###  #     #    #
    { 2, 3, 2, 3 },      //      #         ##
    VCOL_BLUE, 
    {0, 0, 1, 2}, 
    {0, 1, 1, 1}
  },
	{ 6,
    { 0, 0, 1, 1, 1, 1, 
      1, 0, 1, 0, 1, 1,
      1, 1, 1, 1, 0, 0,
      1, 1, 0, 1, 0, 1 },
    { 0, 6, 12, 18 },   //   #  #    ###  ##
    { 3, 2, 3, 2 },     // ###  #    #     #
    { 2, 3, 2, 3 },     //      ##         #
    VCOL_ORANGE,
    {3, 0, 1, 2},
    {0, 1, 1, 1}
  },
	
};

//                          01234567890123456789012345678901234567890
const char StatusText[] = s" SCORE: 000000  LINES: 000000  LEVEL: 00";
//const char StatusText[] = " SCORE: 000000  LINES: 000000   LEVEL: 0 ";

const unsigned char level_y_inc[10] = {4, 6, 9, 12, 15, 18, 21, 24, 27, 30};

struct Game TheGame = {0};

const Vector2 KICK_DATA_GENERIC[8][5] = {
  {{0, 0}, {-1, 0}, {-1, 1}, {0,-2}, {-1,-2}}, // 0 -> 1
  {{0, 0}, { 1, 0}, { 1,-1}, {0, 2}, { 1, 2}}, // 1 -> 0
  {{0, 0}, { 1, 0}, { 1,-1}, {0, 2}, { 1, 2}}, // 1 -> 2
  {{0, 0}, {-1, 0}, {-1, 1}, {0,-2}, {-1,-2}}, // 2 -> 1
  {{0, 0}, { 1, 0}, { 1, 1}, {0,-2}, { 1,-2}}, // 2 -> 3
  {{0, 0}, {-1, 0}, {-1,-1}, {0, 2}, {-1, 2}}, // 3 -> 2
  {{0, 0}, {-1, 0}, {-1,-1}, {0, 2}, {-1, 2}}, // 3 -> 0
  {{0, 0}, { 1, 0}, { 1, 1}, {0,-2}, { 1,-2}}  // 0 -> 3
};

// Tests for I piece
const Vector2 KICK_DATA_I[8][5] = {
  {{0, 0}, {-2, 0}, { 1, 0}, {-2,-1}, { 1, 2}}, // 0 -> 1
  {{0, 0}, { 2, 0}, {-1, 0}, { 2, 1}, {-1,-2}}, // 1 -> 0
  {{0, 0}, {-1, 0}, { 2, 0}, {-1, 2}, { 2,-1}}, // 1 -> 2
  {{0, 0}, { 1, 0}, {-2, 0}, { 1,-2}, {-2, 1}}, // 2 -> 1
  {{0, 0}, { 2, 0}, {-1, 0}, { 2, 1}, {-1,-2}}, // 2 -> 3
  {{0, 0}, {-2, 0}, { 1, 0}, {-2,-1}, { 1, 2}}, // 3 -> 2
  {{0, 0}, { 1, 0}, {-2, 0}, { 1,-2}, {-2, 1}}, // 3 -> 0
  {{0, 0}, {-1, 0}, { 2, 0}, {-1, 2}, { 2,-1}}  // 0 -> 3
};

const byte SpriteImage[64] = {
	0b01010101, 0b00000000, 0b00000000,
  0b01010101, 0b00000000, 0b00000000,
  0b01010101, 0b00000000, 0b00000000,
  0b01010101, 0b00000000, 0b00000000,
  0b01010101, 0b00000000, 0b00000000,
  0b01010101, 0b00000000, 0b00000000,
  0b01010101, 0b00000000, 0b00000000,
  0b01010101, 0b00000000, 0b00000000,
  0b00000000, 0b00000000, 0b00000000,
  0b00000000, 0b00000000, 0b00000000,
  0b00000000, 0b00000000, 0b00000000,
  0b00000000, 0b00000000, 0b00000000,
  0b00000000, 0b00000000, 0b00000000,
  0b00000000, 0b00000000, 0b00000000,
  0b00000000, 0b00000000, 0b00000000,
  0b00000000, 0b00000000, 0b00000000,
  0b00000000, 0b00000000, 0b00000000,
  0b00000000, 0b00000000, 0b00000000,
  0b00000000, 0b00000000, 0b00000000,
  0b00000000, 0b00000000, 0b00000000,
  0b00000000, 0b00000000, 0b00000000
};

const byte SpriteImageC[64] = {
  255,0,0,253,0,0,233,0,0,233,0,0,233,0,0,233,
  0,0,213,0,0,85,0,0,0,0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,135
};

// Scroll character layout in charset (indices 220-235):
//   220       : solid block (all 8 rows = 0xFF)
//   221-227   : top-heavy, offset N=1..7 (top N rows 0xFF, rest 0x00)
//   228-234   : bottom-heavy, offset N=1..7 (top N rows 0x00, rest 0xFF)
//   235       : empty block (all 8 rows = 0x00)
// Must be called while MMAP_CHAR_ROM is active (caller's responsibility).
void generate_scroll_chars(void) {
  char i, n;

  // char 220: solid
  for(i = 0; i < 8; i++) Charset[220 * 8 + i] = 0xFF;

  // chars 221-227: top-heavy for offsets 1-7
  for(n = 1; n <= 7; n++) {
    for(i = 0; i < 8; i++)
      Charset[(220 + n) * 8 + i] = (i < n) ? 0xFF : 0x00;
  }

  // chars 228-234: bottom-heavy for offsets 1-7
  for(n = 1; n <= 7; n++) {
    for(i = 0; i < 8; i++)
      Charset[(227 + n) * 8 + i] = (i < n) ? 0x00 : 0xFF;
  }

  // char 235: empty
  for(i = 0; i < 8; i++) Charset[235 * 8 + i] = 0x00;
}